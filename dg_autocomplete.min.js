dg.createModule("dg_autocomplete"),dg_autocomplete._typingTimer=null,dg_autocomplete._doneTypingInterval=175,dg.autocompletePrepTextInput=function(t){var e=t._text_input?t._text_input:{};return dg.setRenderElementDefaults(e),e._attributes.type="text",e._attributes.id||(e._attributes.id="autocomplete-"+jDrupal.userPassword()),!e._title&&t._title&&t._title_placeholder&&(e._attributes.placeholder=""+t._title),e},dg.autocompletePrepListItem=function(t,e,r,o){return{_theme:"list_item",_i:e,_total:t.length,_text:o,_attributes:{value:r}}},dg.autocompleteAddClassToWidget=function(t,e){t._attributes||(t._attributes={}),t._attributes.class||(t._attributes.class=[]),"string"==typeof t._attributes.class&&(t._attributes.class=[t._attributes.class]),jDrupal.isArray(t._attributes.class)&&!jDrupal.inArray(e,t._attributes.class)&&t._attributes.class.push(e)},dg.autocompleteAttachPostRender=function(t,e,r,o){t._postRender||(t._postRender=[]),t._postRender.push(function(){for(var t=document.getElementById(e._attributes.id),a=e._target?e._target:'[autocomplete="'+r.id+'"]',u=a+" ul.autocomplete li",i=document.querySelectorAll(u),n=0;n<i.length;n++)i[n].setAttribute("delta",n),i[n].onclick=function(){t&&t.setAttribute("value",this.getAttribute("value"));var u=this.getAttribute("data-label");u&&(r.value=u),dg.hide(dg.qs(a)),e._clicker&&e._clicker(t,r,o,this)}})},dg_autocomplete.run=function(t,e){var r=t._target?t._target:'[autocomplete="'+e.id+'"]',o=dg.qs(r),a=function(t){o.innerHTML=t,dg.runPostRenders(),dg.show(o)};return""==e.value?void a(""):void t._fetcher(e).then(function(r){var o=t._handler(e,r);if(o.results){var u=o.results;dg.autocompleteAddClassToWidget(u,"autocomplete"),dg.autocompleteAttachPostRender(u,t,e,r)}a(dg.render(o))})},dg.autocompleteVerify=function(t){var e=t._attributes.id;return t._fetcher?!!t._handler||(console.log("missing _handler for autocomplete: "+e),!1):(console.log("missing _fetcher for autocomplete: "+e),!1)},dg_autocomplete.show=function(t,e){var r='div[autocomplete="'+t+'"]',o=dg.qs(r);e?dg.hide(o):dg.show(o)},dg_autocomplete.hide=function(t){dg_autocomplete.show(t,!0)},dg.theme_autocomplete=function(t){t._attributes.type="hidden";var e=dg.autocompletePrepTextInput(t);if(dg.autocompleteVerify(t)){var r=e._attributes.id,o=t._wrapper?t._wrapper:{};dg.attributesInit(o),o._attributes.class.push("autocomplete-wrapper");var a="<div "+dg.attributes(o._attributes)+">";return a+="<input "+dg.attributes(t._attributes)+"/>",a+="<input "+dg.attributes(e._attributes)+"/>",t._target||(a+='<div autocomplete="'+r+'"></div>'),a+="</div>",dg.render({_markup:a,_postRender:[function(){if(document.getElementById(r).addEventListener("keyup",function(){clearTimeout(dg_autocomplete._typingTimer);var e=this;dg_autocomplete._typingTimer=setTimeout(function(){dg_autocomplete.run(t,e)},dg_autocomplete._doneTypingInterval)}),t._friends)for(var e=t._friends,o=0;o<e.length;o++)for(var a=e[o],u=document.querySelectorAll(a),i=0;i<u.length;i++)u[i].addEventListener("change",function(){dg_autocomplete.run(t,document.getElementById(r))})}]})}};