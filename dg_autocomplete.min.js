dg.createModule("dg_autocomplete"),dg_autocomplete._typingTimer=null,dg_autocomplete._doneTypingInterval=175,dg.autocompletePrepTextInput=function(t){var e=t._text_input?t._text_input:{};return dg.setRenderElementDefaults(e),e._attributes.type="text",e._attributes.id||(e._attributes.id="autocomplete-"+jDrupal.userPassword()),!e._title&&t._title&&t._title_placeholder&&(e._attributes.placeholder=""+t._title),e},dg.autocompletePrepListItem=function(t,e,o,r){return{_theme:"list_item",_i:e,_total:t.length,_text:r,_attributes:{value:o}}},dg.autocompleteAddClassToWidget=function(t,e){t._attributes||(t._attributes={}),t._attributes.class||(t._attributes.class=[]),"string"==typeof t._attributes.class&&(t._attributes.class=[t._attributes.class]),jDrupal.isArray(t._attributes.class)&&!jDrupal.inArray(e,t._attributes.class)&&t._attributes.class.push(e)},dg.autocompleteAttachPostRender=function(t,e,o,r){t._postRender||(t._postRender=[]),t._postRender.push(function(){for(var t=document.getElementById(e._attributes.id),u=e._target?e._target:'[autocomplete="'+o.id+'"]',a=u+" ul.autocomplete li",i=document.querySelectorAll(a),n=0;n<i.length;n++)i[n].setAttribute("delta",n),i[n].onclick=function(){t&&t.setAttribute("value",this.getAttribute("value"));var a=this.getAttribute("data-label");a&&(o.value=a),dg.hide(dg.qs(u)),e._clicker&&e._clicker(t,o,r,this)}})},dg_autocomplete.run=function(t,e){var o=t._target?t._target:'[autocomplete="'+e.id+'"]',r=dg.qs(o),u=function(t){r.innerHTML=t,dg.runPostRenders(),dg.show(r)};return""==e.value?void u(""):void t._fetcher(e).then(function(o){var r=t._handler(e,o);if(r.results){var a=r.results;dg.autocompleteAddClassToWidget(a,"autocomplete"),dg.autocompleteAttachPostRender(a,t,e,o)}u(dg.render(r))})},dg.autocompleteVerify=function(t){var e=t._attributes.id;return t._fetcher?!!t._handler||(console.log("missing _handler for autocomplete: "+e),!1):(console.log("missing _fetcher for autocomplete: "+e),!1)},dg_autocomplete.show=function(t,e){var o='div[autocomplete="'+t+'"]',r=dg.qs(o);e?dg.hide(r):dg.show(r)},dg_autocomplete.hide=function(t){dg_autocomplete.show(t,!0)},dg.theme_autocomplete=function(t){t._attributes.type="hidden";var e=dg.autocompletePrepTextInput(t);if(dg.autocompleteVerify(t)){var o=e._attributes.id,r='<div class="autocomplete-wrapper">';return r+="<input "+dg.attributes(t._attributes)+"/>",r+="<input "+dg.attributes(e._attributes)+"/>",t._target||(r+='<div autocomplete="'+o+'"></div>'),r+="</div>",dg.render({_markup:r,_postRender:[function(){if(document.getElementById(o).addEventListener("keyup",function(){clearTimeout(dg_autocomplete._typingTimer);var e=this;dg_autocomplete._typingTimer=setTimeout(function(){dg_autocomplete.run(t,e)},dg_autocomplete._doneTypingInterval)}),t._friends)for(var e=t._friends,r=0;r<e.length;r++)for(var u=e[r],a=document.querySelectorAll(u),i=0;i<a.length;i++)a[i].addEventListener("change",function(){dg_autocomplete.run(t,document.getElementById(o))})}]})}};